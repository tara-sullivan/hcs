# Overview of `img/code/` directory

	* fig_size.py
	* plot_line_labels.py
	* tikzplotlib_functions.py
	* tol_colors.py
    * README.md

As discussed in my `img` README, the primary output for this project are PDFs generated in TeX, specifically my slides (`writeups/slides/slides.pdf`) and my paper (`writeups/paper/outline.pdf`). 
To generate these PDFs, I compile  `writeups/slides/slides.tex` and `writeups/paper/outline.tex`, respectively (henceforth referred to as `slides.tex` and `outline.tex`). 
These PDFs contain figures generated using programs from my `model/` and `data/` directories.
I generate these figures in Python using matplotlib, but need to save them in a TeX-friendly way.
To do this, I convert my matplotlib lib code to TeX code using  [tikzplotlib](https://github.com/nschloe/tikzplotlib). 
That way, I can natively compile my figures in TeX using [PGF plots](http://pgfplots.sourceforge.net/).

This directory contains programs I commonly import when generating figures in the `/model/` or `/data/` directories. 
I also set some helpful parameters by importing these programs. 
I know there may be better ways of doing this, but this method has worked for me so far.

## `plot_line_labels.py`

I often create plots where each line has a separate color and:
    * Each line is labeled at its approximate endpoint
    * The line label is the same color as the line
This program defines a simple program for doing that.
The function `plot_line_labels.plot_df()` can then be imported and run as follows:
```python
# Create grouped dataset
cipdf = (df.groupby(['year']).aggregate('sum')
            .transform(lambda x: x / 1e6))
# columns to plot and their labels
cols = ['ctotalm', 'ctotalw']
col_labels = {'ctotalm': 'Men', 'ctotalw': 'Women'}
label_edit = {'ctotalm': -.4}
# Use plot_line_labels.plot_df() command
plot_df(df=cipdf,
        cols=cols,
        col_labels=col_labels,
        label_edit=label_edit,
        x_lim=2033,
        yticks=[.6, .8]
)
``` 

## `tikzplotlib_functions.py`

`tikzplotlib_function.py` contains a number of functions I use for customizing the PGF/TikZ code generated by [tikzplotlib](https://github.com/nschloe/tikzplotlib). 
The code generated using  tikzplotlib is a [PGF plot](http://pgfplots.sourceforge.net/), which is based on [PGF/TikZ](https://github.com/pgf-tikz/pgf). 
Therefore, the files generated by these processes begin with `\begin{tizkpicture)`, and end with `\end{tikzpicture}`.

Sometimes I want to manually edit the tikz code generated by tikzplotlib. 
For instance, sometimes I want to add nodes to tikzplotlib code.
These need to be written before the \end{tikzplicutre} command.
Therefore, I select the option wrap=off in tikzplotlib when saving the graph(which removes the `\begin{tizkpicture)` and `\end{tikzpicture}` commands). 
I then write to the file to add any necessary content, like additional nodes, before writing the `\begin{tizkpicture)` and `\end{tikzpicture}` commands.

The code in this section is particularly helpful for generating subplots. 
To create subplot titles that can be referenced, you want to use the `\subcaption` package within a tikz node.

In python, initialize the figure and the subplot titles string:
```python
# Initialize figure for paper
fig, ax = plt.subplots(3, 3, sharex=True, sharey=True)
# initial groupplot stuff
subplot_titles = ''
ref_name = 'fig:beta_ex'
```
After generate each subplot, use the `tikzplotlib_functions.subplot_title()` to append the appropriate information to the `subplot_titles` string.
This will create a new node in the TeX output that uses the `\subcaption` command:
```python
subplot_titles += tikzplotlib_functions.subplot_title(
    ax_loc=[i, j], ref_name=ref_name,
    subtitle_id=subtitle_id, plt_title=plt_title,
    text_width=size.w(0.65)
)
```
You can then use the `tikzplotlib_functions.save_subplots()` function to save these group plots:
```python
tplf.save_subplots(
    imgpath + 'beta_example_change.tex',
    clean_figure=True,
    node_code=subplot_titles, caption=caption_str,
    extra_groupstyle_parameters={'horizontal sep=0.75cm'}
)
```
Note that the end of of my generated figure will have all of the generated nodes. The caption string will appear after the `\endpicture{}`
```
\end{groupplot}

\node [text width=5.3649245cm, align=center, anchor=south] at (my plots c1r1.north) {\subcaption{\label{fig:beta_ex_a} $(\alpha_0, \beta_0) = (1, 1)$}};
\node [text width=5.3649245cm, align=center, anchor=south] at (my plots c2r1.north) {\subcaption{\label{fig:beta_ex_b} $(\alpha_0, \beta_0) = (2, 1)$}};
\node [text width=5.3649245cm, align=center, anchor=south] at (my plots c3r1.north) {\subcaption{\label{fig:beta_ex_c} $(\alpha_0, \beta_0) = (3, 1)$}};
\node [text width=5.3649245cm, align=center, anchor=south] at (my plots c1r2.north) {\subcaption{\label{fig:beta_ex_d} $(\alpha_0, \beta_0) = (1, 2)$}};
\node [text width=5.3649245cm, align=center, anchor=south] at (my plots c2r2.north) {\subcaption{\label{fig:beta_ex_e} $(\alpha_0, \beta_0) = (2, 2)$}};
\node [text width=5.3649245cm, align=center, anchor=south] at (my plots c3r2.north) {\subcaption{\label{fig:beta_ex_f} $(\alpha_0, \beta_0) = (3, 2)$}};
\node [text width=5.3649245cm, align=center, anchor=south] at (my plots c1r3.north) {\subcaption{\label{fig:beta_ex_g} $(\alpha_0, \beta_0) = (1, 3)$}};
\node [text width=5.3649245cm, align=center, anchor=south] at (my plots c2r3.north) {\subcaption{\label{fig:beta_ex_h} $(\alpha_0, \beta_0) = (2, 3)$}};
\node [text width=5.3649245cm, align=center, anchor=south] at (my plots c3r3.north) {\subcaption{\label{fig:beta_ex_i} $(\alpha_0, \beta_0) = (3, 3)$}};

\end{tikzpicture}

\caption{Evolution of the Beta distribution $\mathcal{B} (\alpha_{0}, \beta_{0})$ for different values of $(\alpha_{0}, \beta_{0})$.}
```

## `fig_size.py`

`fig_size.py` creates a Python class ArticleSize that has ideal figure height and width for my current TeX documents. 
When I create images, I often import this class as follows: 
```python
# get figure heigth and width
from img.code.figsize import ArticleSize
size = ArticleSize()
```
I then reference size and width using `size.w()`or `size.h()`. 

## `tol_colors.py`

Colour schemes for lines and maps that also work for colour-blind
people. See https://personal.sron.nl/~pault/ for background information and
best usage of the schemes.